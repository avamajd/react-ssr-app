{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport { LOGIN, SET_USERNAME, SET_USERNAME_ERROR, SET_TOKEN, SET_TOKEN_COMPLETE, SET_TOKEN_ERROR, LOGOUT, LOGIN_ERROR } from \"../constants\";\nvar baseUrl = \"https://api.tavanito.ir/v2\"; // export const login = username => {\n//   return {\n//     type: LOGIN,\n//     username\n//   };\n// };\n// // send otp and fetch token\n// export const setToken = otp => {\n//   return {\n//     type: SET_TOKEN,\n//     otp\n//   };\n// };\n\nexport var logout = function logout() {\n  return {\n    type: LOGOUT\n  };\n};\nexport var login = function login(mobile) {\n  var uri = \"\".concat(baseUrl, \"/login/otp\");\n  return function (dispatch) {\n    dispatch(function () {\n      return {\n        type: LOGIN\n      };\n    });\n    fetch(uri, {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      },\n      body: _JSON$stringify({\n        mobile: mobile\n      })\n    }) // .then(res => res.json())\n    .then(function (res) {\n      res.json().then(function (res) {\n        console.log(\"here\", res);\n\n        if (res.message) {\n          dispatch(function () {\n            return {\n              type: SET_USERNAME,\n              username: mobile,\n              message: res.message\n            };\n          });\n        } else if (res.errors && res.errors.mobile.length !== 0) dispatch(function () {\n          return {\n            type: SET_USERNAME_ERROR,\n            error: res.errors.mobile[0]\n          };\n        });\n      });\n    })[\"catch\"](function (err) {\n      dispatch(function () {\n        return {\n          type: SET_USERNAME_ERROR,\n          err: err\n        };\n      });\n    });\n  };\n}; //*******************************************\n\nexport var setToken = function setToken(otp) {\n  var mobile = getState.username;\n  var uri = \"\".concat(baseUrl, \"/login?mobile=\").concat(mobile, \"&code=\").concat(otp);\n  return function (dispatch, getState) {\n    dispatch(function () {\n      return {\n        type: SET_TOKEN\n      };\n    });\n    fetch(uri, {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      },\n      body: _JSON$stringify({\n        mobile: mobile\n      })\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res) {\n      if (res.access_token && res.access_token !== \"\") {\n        dispatch(function () {\n          return {\n            type: SET_TOKEN_COMPLETE,\n            token: result.access_token\n          };\n        });\n        dispatch(function () {\n          return {\n            type: LOGIN_COMPLETE\n          };\n        });\n      } else if (res.errors && res.errors.mobile.length !== 0) {\n        dispatch(function () {\n          return {\n            type: SET_TOKEN_ERROR,\n            error: res.errors.mobile[0]\n          };\n        });\n        dispatch(function () {\n          return {\n            type: LOGIN_ERROR\n          };\n        });\n      }\n    })[\"catch\"](function (err) {\n      dispatch(function () {\n        return {\n          type: SET_TOKEN_ERROR,\n          err: err\n        };\n      });\n    });\n  };\n};","map":{"version":3,"sources":["G:/projects/nextjs-tavanito/src/actions/authActions.js"],"names":["LOGIN","SET_USERNAME","SET_USERNAME_ERROR","SET_TOKEN","SET_TOKEN_COMPLETE","SET_TOKEN_ERROR","LOGOUT","LOGIN_ERROR","baseUrl","logout","type","login","mobile","uri","dispatch","fetch","method","headers","Accept","body","then","res","json","console","log","message","username","errors","length","error","err","setToken","otp","getState","access_token","token","result","LOGIN_COMPLETE"],"mappings":"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","sourcesContent":["import { LOGIN, SET_USERNAME, SET_USERNAME_ERROR, SET_TOKEN, SET_TOKEN_COMPLETE, SET_TOKEN_ERROR, LOGOUT, LOGIN_ERROR } from \"../constants\";\r\n\r\nconst baseUrl = \"https://api.tavanito.ir/v2\";\r\n\r\n// export const login = username => {\r\n//   return {\r\n//     type: LOGIN,\r\n//     username\r\n//   };\r\n// };\r\n\r\n// // send otp and fetch token\r\n// export const setToken = otp => {\r\n//   return {\r\n//     type: SET_TOKEN,\r\n//     otp\r\n//   };\r\n// };\r\n\r\nexport const logout = () => {\r\n  return {\r\n    type: LOGOUT\r\n  };\r\n};\r\n\r\nexport const login = (mobile) => {\r\n\r\n  let uri = `${baseUrl}/login/otp`;\r\n\r\n  return dispatch => {\r\n    dispatch(() => {\r\n      return {\r\n        type: LOGIN\r\n      }\r\n    }\r\n    )\r\n\r\n    fetch(uri, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify({\r\n        mobile\r\n      })\r\n    })\r\n      // .then(res => res.json())\r\n      .then(res => {\r\n        res.json().then(res => {\r\n          console.log(\"here\", res)\r\n          if (res.message) {\r\n            dispatch(() => {\r\n              return {\r\n                type: SET_USERNAME, username: mobile, message: res.message\r\n              }\r\n            })\r\n          }\r\n          else if (res.errors && res.errors.mobile.length !== 0)\r\n            dispatch(() => {\r\n              return {\r\n                type: SET_USERNAME_ERROR, error: res.errors.mobile[0]\r\n              }\r\n            })\r\n        })\r\n      })\r\n      .catch(err => {\r\n        dispatch(() => ({\r\n          type: SET_USERNAME_ERROR, err\r\n        }));\r\n      });\r\n  };\r\n};\r\n\r\n//*******************************************\r\n\r\nexport const setToken = (otp) => {\r\n  const mobile = getState.username\r\n\r\n  let uri = `${baseUrl}/login?mobile=${mobile}&code=${otp}`;\r\n\r\n  return (dispatch, getState) => {\r\n    dispatch(() => ({\r\n      type: SET_TOKEN\r\n    })\r\n    )\r\n\r\n    fetch(uri, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify({\r\n        mobile\r\n      })\r\n    })\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        if (res.access_token && res.access_token !== \"\") {\r\n          dispatch(() => ({\r\n            type: SET_TOKEN_COMPLETE, token: result.access_token\r\n          }))\r\n          dispatch(() => ({\r\n            type: LOGIN_COMPLETE\r\n          }))\r\n        }\r\n        else if (res.errors && res.errors.mobile.length !== 0) {\r\n          dispatch(() => ({\r\n            type: SET_TOKEN_ERROR, error: res.errors.mobile[0]\r\n          }))\r\n          dispatch(() => ({\r\n            type: LOGIN_ERROR\r\n          }))\r\n        }\r\n\r\n      })\r\n      .catch(err => {\r\n        dispatch(() => ({\r\n          type: SET_TOKEN_ERROR, err\r\n        }));\r\n      });\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}