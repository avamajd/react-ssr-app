{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport { LOGIN, LOGIN_COMPLETE, LOGIN_ERROR, SET_USERNAME, SET_USERNAME_ERROR, SET_TOKEN, SET_TOKEN_COMPLETE, SET_TOKEN_ERROR, LOGOUT } from \"../constants\";\nimport thunk from \"redux-thunk\";\nvar baseUrl = \"https://api.tavanito.ir/v2\"; //******************************************\n\nvar loginReq = function loginReq() {\n  return {\n    type: LOGIN\n  };\n};\n\nvar setUsername = function setUsername(mobile, message) {\n  return {\n    type: SET_USERNAME,\n    username: mobile,\n    message: message\n  };\n};\n\nvar setUsernameError = function setUsernameError(error) {\n  return {\n    type: SET_USERNAME_ERROR,\n    error: error\n  };\n};\n\nexport var login = function login(mobile) {\n  var uri = \"\".concat(baseUrl, \"/login/otp\");\n  return function (dispatch) {\n    dispatch(loginReq());\n    fetch(uri, {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      },\n      body: _JSON$stringify({\n        mobile: mobile\n      })\n    }).then(function (res) {\n      res.json().then(function (res) {\n        if (res.message) {\n          dispatch(setUsername(mobile, res.message));\n        } else if (res.errors && res.errors.mobile.length !== 0) dispatch(setUsernameError(res.errors.mobile[0]));\n      });\n    })[\"catch\"](function (err) {\n      dispatch(setUsernameError(err));\n    });\n  };\n}; //*******************************************\n\nvar setTokenReq = function setTokenReq() {\n  return {\n    type: SET_TOKEN\n  };\n};\n\nvar setTokenComplete = function setTokenComplete(token) {\n  return {\n    type: SET_TOKEN_COMPLETE,\n    token: token\n  };\n};\n\nvar loginComplete = function loginComplete() {\n  return {\n    type: LOGIN_COMPLETE\n  };\n};\n\nvar setTokenError = function setTokenError(error) {\n  return {\n    type: SET_TOKEN_ERROR,\n    error: error\n  };\n};\n\nvar loginError = function loginError() {\n  return {\n    type: LOGIN_ERROR\n  };\n};\n\nexport var setToken = function setToken(otp) {\n  return function (dispatch, getState) {\n    var mobile = getState().auth.username;\n    var uri = \"\".concat(baseUrl, \"/login?mobile=\").concat(mobile, \"&code=\").concat(otp);\n    dispatch(setTokenReq());\n    fetch(uri, {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      },\n      body: _JSON$stringify({\n        mobile: mobile\n      })\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res) {\n      if (res.access_token && res.access_token !== \"\") {\n        dispatch(setTokenComplete(res.access_token));\n        dispatch(loginComplete());\n      } else if (res.errors && res.errors.mobile.length !== 0) {\n        dispatch(setTokenError(res.errors.mobile[0]));\n        dispatch(loginError());\n      }\n    })[\"catch\"](function (err) {\n      dispatch(setTokenError(err));\n    });\n  };\n}; //******************************************\n\nexport var logout = function logout() {\n  return {\n    type: LOGOUT\n  };\n};","map":{"version":3,"sources":["G:/projects/nextjs-tavanito/src/actions/authActions.js"],"names":["LOGIN","LOGIN_COMPLETE","LOGIN_ERROR","SET_USERNAME","SET_USERNAME_ERROR","SET_TOKEN","SET_TOKEN_COMPLETE","SET_TOKEN_ERROR","LOGOUT","thunk","baseUrl","loginReq","type","setUsername","mobile","message","username","setUsernameError","error","login","uri","dispatch","fetch","method","headers","Accept","body","then","res","json","errors","length","err","setTokenReq","setTokenComplete","token","loginComplete","setTokenError","loginError","setToken","otp","getState","auth","access_token","logout"],"mappings":"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","sourcesContent":["import {\r\n  LOGIN, LOGIN_COMPLETE, LOGIN_ERROR,\r\n  SET_USERNAME, SET_USERNAME_ERROR,\r\n  SET_TOKEN, SET_TOKEN_COMPLETE, SET_TOKEN_ERROR,\r\n  LOGOUT,\r\n} from \"../constants\";\r\n\r\nimport thunk from \"redux-thunk\"\r\n\r\nconst baseUrl = \"https://api.tavanito.ir/v2\";\r\n\r\n\r\n//******************************************\r\n\r\nconst loginReq = () => ({\r\n  type: LOGIN\r\n})\r\n\r\nconst setUsername = (mobile, message) => ({\r\n  type: SET_USERNAME,\r\n  username: mobile,\r\n  message\r\n})\r\n\r\nconst setUsernameError = (error) => ({\r\n  type: SET_USERNAME_ERROR,\r\n  error\r\n})\r\n\r\nexport const login = (mobile) => {\r\n\r\n  let uri = `${baseUrl}/login/otp`;\r\n\r\n  return dispatch => {\r\n    dispatch(loginReq())\r\n\r\n    fetch(uri, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify({\r\n        mobile\r\n      })\r\n    })\r\n      .then(res => {\r\n        res.json().then(res => {\r\n          if (res.message) {\r\n            dispatch(setUsername(mobile, res.message))\r\n          }\r\n          else if (res.errors && res.errors.mobile.length !== 0)\r\n            dispatch(setUsernameError(res.errors.mobile[0]))\r\n        })\r\n      })\r\n      .catch(err => {\r\n        dispatch(setUsernameError(err));\r\n      });\r\n  };\r\n};\r\n\r\n//*******************************************\r\n\r\nconst setTokenReq = () => ({\r\n  type: SET_TOKEN\r\n})\r\n\r\nconst setTokenComplete = (token) => ({\r\n  type: SET_TOKEN_COMPLETE,\r\n  token\r\n})\r\n\r\nconst loginComplete = () => ({\r\n  type: LOGIN_COMPLETE\r\n})\r\n\r\nconst setTokenError = (error) => ({\r\n  type: SET_TOKEN_ERROR,\r\n  error\r\n})\r\n\r\nconst loginError = () => ({\r\n  type: LOGIN_ERROR\r\n})\r\n\r\nexport const setToken = (otp) => {\r\n  return (dispatch, getState) => {\r\n\r\n    const mobile = getState().auth.username\r\n\r\n    let uri = `${baseUrl}/login?mobile=${mobile}&code=${otp}`;\r\n\r\n    dispatch(setTokenReq())\r\n\r\n    fetch(uri, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify({\r\n        mobile\r\n      })\r\n    })\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        if (res.access_token && res.access_token !== \"\") {\r\n          dispatch(setTokenComplete(res.access_token))\r\n          dispatch(loginComplete())\r\n        }\r\n        else if (res.errors && res.errors.mobile.length !== 0) {\r\n          dispatch(setTokenError(res.errors.mobile[0]))\r\n          dispatch(loginError())\r\n        }\r\n\r\n      })\r\n      .catch(err => {\r\n        dispatch(setTokenError(err));\r\n      });\r\n  };\r\n};\r\n\r\n//******************************************\r\n\r\nexport const logout = () => {\r\n  return {\r\n    type: LOGOUT\r\n  };\r\n};\r\n\r\n"]},"metadata":{},"sourceType":"module"}