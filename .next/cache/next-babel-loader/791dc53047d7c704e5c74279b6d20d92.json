{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport { LOGIN, LOGIN_COMPLETE, LOGIN_ERROR, SET_USERNAME, SET_USERNAME_ERROR, SET_TOKEN, SET_TOKEN_COMPLETE, SET_TOKEN_ERROR, LOGOUT } from \"../constants\";\nimport thunk from \"redux-thunk\";\nconst baseUrl = \"https://api.tavanito.ir/v2\"; // export const login = username => {\n//   return {\n//     type: LOGIN,\n//     username\n//   };\n// };\n// // send otp and fetch token\n// export const setToken = otp => {\n//   return {\n//     type: SET_TOKEN,\n//     otp\n//   };\n// };\n\nexport const logout = () => {\n  return {\n    type: LOGOUT\n  };\n};\n\nconst loginReq = () => ({\n  type: LOGIN\n});\n\nconst setUsername = (mobile, message) => ({\n  type: SET_USERNAME,\n  username: mobile,\n  message\n});\n\nconst setUsernameError = error => ({\n  type: SET_USERNAME_ERROR,\n  error\n});\n\nexport const login = mobile => {\n  let uri = `${baseUrl}/login/otp`;\n  return dispatch => {\n    dispatch(loginReq());\n    fetch(uri, {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      },\n      body: _JSON$stringify({\n        mobile\n      })\n    }) // .then(res => res.json())\n    .then(res => {\n      res.json().then(res => {\n        console.log(\"here\", res);\n\n        if (res.message) {\n          dispatch(setUsername(mobile, res.message));\n        } else if (res.errors && res.errors.mobile.length !== 0) dispatch(setUsernameError(res.errors.mobile[0]));\n      });\n    }).catch(err => {\n      dispatch(setUsernameError(err));\n    });\n  };\n}; //*******************************************\n\nexport const setToken = otp => {\n  return (dispatch, getState) => {\n    const mobile = getState().auth.username;\n    let uri = `${baseUrl}/login?mobile=${mobile}&code=${otp}`;\n    dispatch(() => ({\n      type: SET_TOKEN\n    }));\n    fetch(uri, {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      },\n      body: _JSON$stringify({\n        mobile\n      })\n    }).then(res => res.json()).then(res => {\n      if (res.access_token && res.access_token !== \"\") {\n        dispatch(() => ({\n          type: SET_TOKEN_COMPLETE,\n          token: result.access_token\n        }));\n        dispatch(() => ({\n          type: LOGIN_COMPLETE\n        }));\n      } else if (res.errors && res.errors.mobile.length !== 0) {\n        dispatch(() => ({\n          type: SET_TOKEN_ERROR,\n          error: res.errors.mobile[0]\n        }));\n        dispatch(() => ({\n          type: LOGIN_ERROR\n        }));\n      }\n    }).catch(err => {\n      dispatch(() => ({\n        type: SET_TOKEN_ERROR,\n        err\n      }));\n    });\n  };\n};","map":{"version":3,"sources":["G:/projects/nextjs-tavanito/src/actions/authActions.js"],"names":["LOGIN","LOGIN_COMPLETE","LOGIN_ERROR","SET_USERNAME","SET_USERNAME_ERROR","SET_TOKEN","SET_TOKEN_COMPLETE","SET_TOKEN_ERROR","LOGOUT","thunk","baseUrl","logout","type","loginReq","setUsername","mobile","message","username","setUsernameError","error","login","uri","dispatch","fetch","method","headers","Accept","body","then","res","json","console","log","errors","length","catch","err","setToken","otp","getState","auth","access_token","token","result"],"mappings":"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","sourcesContent":["import {\r\n  LOGIN, LOGIN_COMPLETE, LOGIN_ERROR,\r\n  SET_USERNAME, SET_USERNAME_ERROR,\r\n  SET_TOKEN, SET_TOKEN_COMPLETE, SET_TOKEN_ERROR,\r\n  LOGOUT,\r\n} from \"../constants\";\r\n\r\nimport thunk from \"redux-thunk\"\r\n\r\nconst baseUrl = \"https://api.tavanito.ir/v2\";\r\n\r\n// export const login = username => {\r\n//   return {\r\n//     type: LOGIN,\r\n//     username\r\n//   };\r\n// };\r\n\r\n// // send otp and fetch token\r\n// export const setToken = otp => {\r\n//   return {\r\n//     type: SET_TOKEN,\r\n//     otp\r\n//   };\r\n// };\r\n\r\nexport const logout = () => {\r\n  return {\r\n    type: LOGOUT\r\n  };\r\n};\r\n\r\nconst loginReq = () => ({\r\n  type: LOGIN\r\n})\r\n\r\nconst setUsername = (mobile, message) => ({\r\n  type: SET_USERNAME,\r\n  username: mobile,\r\n  message\r\n})\r\n\r\nconst setUsernameError = (error) => ({\r\n  type: SET_USERNAME_ERROR,\r\n  error\r\n})\r\n\r\nexport const login = (mobile) => {\r\n\r\n  let uri = `${baseUrl}/login/otp`;\r\n\r\n  return dispatch => {\r\n    dispatch(loginReq())\r\n\r\n    fetch(uri, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify({\r\n        mobile\r\n      })\r\n    })\r\n      // .then(res => res.json())\r\n      .then(res => {\r\n        res.json().then(res => {\r\n          console.log(\"here\", res)\r\n          if (res.message) {\r\n            dispatch(setUsername(mobile, res.message))\r\n          }\r\n          else if (res.errors && res.errors.mobile.length !== 0)\r\n            dispatch(setUsernameError(res.errors.mobile[0]))\r\n        })\r\n      })\r\n      .catch(err => {\r\n        dispatch(setUsernameError(err));\r\n      });\r\n  };\r\n};\r\n\r\n//*******************************************\r\n\r\nexport const setToken = (otp) => {\r\n  return (dispatch, getState) => {\r\n\r\n    const mobile = getState().auth.username\r\n\r\n    let uri = `${baseUrl}/login?mobile=${mobile}&code=${otp}`;\r\n\r\n    dispatch(() => ({\r\n      type: SET_TOKEN\r\n    })\r\n    )\r\n\r\n    fetch(uri, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify({\r\n        mobile\r\n      })\r\n    })\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        if (res.access_token && res.access_token !== \"\") {\r\n          dispatch(() => ({\r\n            type: SET_TOKEN_COMPLETE, token: result.access_token\r\n          }))\r\n          dispatch(() => ({\r\n            type: LOGIN_COMPLETE\r\n          }))\r\n        }\r\n        else if (res.errors && res.errors.mobile.length !== 0) {\r\n          dispatch(() => ({\r\n            type: SET_TOKEN_ERROR, error: res.errors.mobile[0]\r\n          }))\r\n          dispatch(() => ({\r\n            type: LOGIN_ERROR\r\n          }))\r\n        }\r\n\r\n      })\r\n      .catch(err => {\r\n        dispatch(() => ({\r\n          type: SET_TOKEN_ERROR, err\r\n        }));\r\n      });\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}